name: Daily job

on:
  schedule:
    - cron: '0 3 * * *'

jobs:
  pickTeam:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    - name: Checkout
      uses: actions/checkout@v4.1.7
    - name: Setup Python
      uses: actions/setup-python@v5.2.0
    - name: Install glpk-utils
      run: sudo apt-get install glpk-utils
    - name: Install deps
      run: pip3 install -r requirements.txt
    - name: Install playwright deps
      run: playwright install --with-deps firefox
    - name: Run solver
      env:
        FANTASY_PL_USERNAME: ${{ secrets.FANTASY_PL_USERNAME }}
        FANTASY_PL_PASSWORD: ${{ secrets.FANTASY_PL_PASSWORD }}
      run: python3 main.py $FANTASY_PL_USERNAME --password $FANTASY_PL_PASSWORD --log-level debug --apply --check-deadline
    - name: Upload Playwright video
      uses: actions/upload-artifact@v4
      if: failure()
      with:
        name: playwright_videos
        path: ./playwright_videos
        retention-days: 1